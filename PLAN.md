# План действий для добавления функций кнопок

## Цель
Реализовать функциональность для кнопок "О чем статья?", "Тезисы" и "Пост для Telegram", чтобы каждая кнопка генерировала соответствующий контент с помощью AI на основе распарсенной статьи.

## Текущее состояние
- ✅ Есть API endpoint `/api/parse-article` для парсинга статей
- ✅ Есть API endpoint `/api/translate-article` для перевода через OpenRouter AI
- ✅ В интерфейсе есть кнопки, но они пока только показывают сырой распарсенный контент
- ✅ Используется OpenRouter API с моделью `deepseek/deepseek-r1-0528:free`

## Порядок действий

### 1. Создание API endpoint для AI-обработки статей
**Файл:** `app/api/process-article/route.ts`

- Создать новый API route handler, который будет принимать:
  - `url` - URL статьи
  - `actionType` - тип действия: `'summary' | 'theses' | 'telegram'`
- Реализовать логику:
  1. Вызвать `/api/parse-article` для получения распарсенной статьи (или использовать прямую логику парсинга)
  2. Сформировать промпт в зависимости от `actionType`:
     - **summary** ("О чем статья?"): запросить краткое резюме статьи на русском языке
     - **theses** ("Тезисы"): запросить основные тезисы/ключевые моменты статьи в виде списка
     - **telegram** ("Пост для Telegram"): запросить пост для Telegram в формате, подходящем для публикации
  3. Вызвать OpenRouter API с соответствующим промптом
  4. Обработать ответ и вернуть результат

### 2. Обновление фронтенда для вызова нового API
**Файл:** `app/page.tsx`

- Обновить функцию `handleSubmit`:
  - Вместо простого парсинга статьи, вызывать новый endpoint `/api/process-article`
  - Передавать `type` (summary/theses/telegram) в запросе
  - Обработать ответ и отобразить результат в блоке результатов
- Убедиться, что состояние `actionType` правильно устанавливается для корректного отображения заголовка

### 3. Настройка промптов для каждого типа действия

#### Промпт для "О чем статья?" (summary)
- Запросить краткое резюме статьи на русском языке
- Указать, что нужно описать основную тему, ключевые идеи и выводы
- Формат: связный текст

#### Промпт для "Тезисы" (theses)
- Запросить основные тезисы статьи
- Формат: нумерованный или маркированный список ключевых моментов
- На русском языке

#### Промпт для "Пост для Telegram" (telegram)
- Запросить пост для Telegram на основе статьи
- Указать требования:
  - Привлекательный заголовок
  - Краткое содержание
  - Подходящий для Telegram формат (можно использовать эмодзи, хештеги)
  - Ограничение по длине (рекомендуется ~2000 символов)
- На русском языке

### 4. Обработка ошибок
- Добавить обработку ошибок на уровне API:
  - Проверка наличия API ключа OpenRouter
  - Обработка ошибок парсинга статьи
  - Обработка ошибок запроса к OpenRouter
- Добавить обработку ошибок на фронтенде:
  - Показывать понятные сообщения об ошибках пользователю
  - Обрабатывать случаи, когда статья не найдена или не может быть распарсена

### 5. Оптимизация и улучшения
- Рассмотреть возможность кэширования распарсенных статей (опционально)
- Добавить индикацию прогресса (уже есть `isLoading`)
- Убедиться, что длинные ответы от AI корректно отображаются в блоке результатов

## Технические детали

### Используемые технологии
- Next.js 14 (App Router)
- OpenRouter API для AI-обработки
- Модель: `deepseek/deepseek-r1-0528:free` (или другая доступная модель)
- Cheerio для парсинга HTML

### Структура запроса к OpenRouter
```typescript
{
  model: 'deepseek/deepseek-r1-0528:free',
  messages: [
    { 
      role: 'system', 
      content: 'Системный промпт в зависимости от типа действия' 
    },
    { 
      role: 'user', 
      content: 'Промпт с текстом статьи и инструкциями' 
    }
  ]
}
```

### Переменные окружения
- `OPENROUTER_API_KEY` - должен быть установлен в `.env.local`

## Последовательность реализации
1. Создать `app/api/process-article/route.ts` с базовой структурой
2. Реализовать логику парсинга статьи (можно переиспользовать из `/api/parse-article`)
3. Добавить формирование промптов для каждого типа действия
4. Интегрировать вызов OpenRouter API
5. Обновить `app/page.tsx` для использования нового endpoint
6. Протестировать все три типа действий
7. Добавить обработку ошибок и улучшить UX

